<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>User Flashcards</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
        }

        #sidebar {
    height: 100vh;
    width: 60px;
    background-color: #111;
    overflow-x: hidden;
    transition: width 0.3s;
    color: white;
    display: flex;
    flex-direction: column;
    padding-top: 20px;
    position: relative;
    }

    #sidebar.expanded {
        width: 200px;
    }

    .sidebar-item {
        display: flex;
        align-items: center;
        width: 100%;
        padding: 10px;
        cursor: pointer;
        color: #818181;
        transition: background-color 0.3s, color 0.3s;
    }

    .sidebar-item:hover {
        background-color: #333;
        color: white;
    }

    .sidebar-icon {
        font-size: 20px;
        width: 30px;
        text-align: center;
    }

    .label {
        opacity: 0;
        white-space: nowrap;
        overflow: hidden;
        transition: opacity 0.3s ease, margin-left 0.3s ease;
        margin-left: 0;
    }

    #sidebar.expanded .label {
        opacity: 1;
        margin-left: 10px;
    }

    #sidebar:not(.expanded) .label {
        display: none;
    }

    #logoutButton {
        margin-top: auto;
        margin-bottom: 30px;
    }


            #main-content {
                flex: 1;
                padding: 20px;
                display: flex;
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            input, textarea, button {
                margin: 5px 0;
                width: 300px;
                padding: 5px;
            }

            .flashcard, .set-card {
                border: 1px solid #ccc;
                padding: 10px;
                margin: 10px 0;
                width: 350px;
                text-align: left;
            }

            #cardsContainer {
                margin-top: 20px;
                width: 350px;
            }

            #flashcard-container {
            margin-top: 40px;
            text-align: center;
            }

            #flashcard {
                width: 300px;
                height: 200px;
                border: 1px solid #ccc;
                background-color: #2d2d50;
                color: white;
                font-size: 24px;
                display: flex;
                justify-content: center;
                align-items: center;
                margin: 0 auto 20px auto;
                border-radius: 10px;
                cursor: pointer;
                user-select: none;
            }

            #controls {
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 10px;
            }

            #card-counter {
                font-weight: bold;
            }
            #flashcardContainer {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
            }

            #flashcard {
                width: 300px;
                height: 180px;
                border: 2px solid #333;
                border-radius: 8px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
                text-align: center;
                cursor: pointer;
                user-select: none;
                background-color: #f9f9f9;
                box-shadow: 2px 2px 12px rgba(0,0,0,0.2);
                transition: transform 0.5s;
            }

            #controls {
                margin-top: 15px;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            button {
                padding: 5px 10px;
                cursor: pointer;
            }

            #counter {
                font-weight: bold;
            }

            .flashcard {
                background-color: #fff;
                border: 1px solid #ccc;
                border-radius: 4px;
                padding: 10px;
                margin-bottom: 10px;
                width: 350px;
            }


        </style>
    </head>
    <body>

    <div id="sidebar-container"></div>

    <div id="main-content">
        <h1>Flashcards</h1>

        <h3>Auto-fill Definition</h3>
        <input type="text" id="vocabWord" placeholder="Enter a word">
        <button onclick="lookupWord()">Lookup Definition</button>

        <p id="partOfSpeech"></p>
        <p id="definition"></p>
        <button onclick="saveFlashcard()">Save Flashcard</button>

        <hr>

        <h3>Create a Flashcard Set</h3>
        <input type="text" id="setTitle" placeholder="Set Title">
        <textarea id="setDescription" placeholder="Set Description"></textarea>

        <div id="cardsContainer"></div>
        <button onclick="addCard()">+ Add Card</button>
        <button onclick="saveSet()">Save Set</button>

        <hr>

        <h3>Saved Flashcard Sets</h3>
        <div id="savedSets"></div>
        
        <!-- Flashcard Viewer -->
        <div id="flashcard-container">
            <div id="flashcard" onclick="flipCard()">Front of Card</div>

            <div id="controls">
                <button onclick="prevCard()">â¬…</button>
                <span id="card-counter">1 / X</span>
                <button onclick="nextCard()">âž¡</button>
                <button onclick="shuffleCards()">ðŸ”€ Shuffle</button>
            </div>
        </div>


    </div>

    <script>
        // Inject sidebar
        fetch('/sidebar.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('sidebar-container').innerHTML = html;

                const sidebar = document.getElementById('sidebar');
                if (sidebar) {
                    sidebar.addEventListener('mouseenter', () => sidebar.classList.add('expanded'));
                    sidebar.addEventListener('mouseleave', () => sidebar.classList.remove('expanded'));
                }

                const logoutButton = document.getElementById('logoutButton');
                if (logoutButton) {
                    logoutButton.addEventListener('click', () => {
                        localStorage.clear();
                        window.location.href = '/';
                    });
                }
            });

        // Auto-fill definition
        async function lookupWord() {
            const word = document.getElementById('vocabWord').value;
            if (!word) return alert('Enter a word first');

            const res = await fetch(`/api/flashcards/lookup/${word}`);
            const data = await res.json();

            if (res.ok) {
                document.getElementById('partOfSpeech').innerText = `Part of Speech: ${data.partOfSpeech}`;
                document.getElementById('definition').innerText = `Definition: ${data.definition}`;
            } else {
                alert(data.message);
            }
        }

        async function saveFlashcard() {
            const word = document.getElementById('vocabWord').value;
            const partOfSpeech = document.getElementById('partOfSpeech').innerText.split(': ')[1];
            const definition = document.getElementById('definition').innerText.split(': ')[1];

            if (!word || !partOfSpeech || !definition) {
                alert('Lookup a word first');
                return;
            }

            const res = await fetch('/api/flashcards/save', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    userId: 'LOGGED_IN_USER_ID', // Replace dynamically
                    word, partOfSpeech, definition
                })
            });

            const data = await res.json();
            alert(data.message);
        }

        function addCard(front = '', back = '') {
            const div = document.createElement('div');
            div.className = 'set-card';
            div.innerHTML = `
                <input type="text" placeholder="Front" class="front" value="${front}" required>
                <input type="text" placeholder="Back" class="back" value="${back}" required>
            `;
            document.getElementById('cardsContainer').appendChild(div);
        }

        async function saveSet() {
            const title = document.getElementById('setTitle').value;
            const description = document.getElementById('setDescription').value;
            const fronts = document.querySelectorAll('.front');
            const backs = document.querySelectorAll('.back');

            if (!title || fronts.length === 0) {
                alert('Please add a title and at least one card.');
                return;
            }

            const setRes = await fetch('/api/flashcards/sets', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title, description, createdBy: 'Anonymous' })
            });
            const setData = await setRes.json();

            for (let i = 0; i < fronts.length; i++) {
                await fetch('/api/flashcards/cards', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        front: fronts[i].value,
                        back: backs[i].value,
                        setId: setData._id
                    })
                });
            }

            alert('Flashcard Set Saved');
            loadSavedSets();
        }

        async function loadSavedSets() {
            const res = await fetch('/api/flashcards/sets');
            const sets = await res.json();

            const container = document.getElementById('savedSets');
            container.innerHTML = '';
            sets.forEach(set => {
    const div = document.createElement('div');
    div.className = 'flashcard';
    div.innerHTML = `
                <strong>${set.title}</strong><br>
                ${set.description}<br>
                <a href="/viewSet.html?id=${set._id}">View Set</a>
                <button onclick="loadSetToStudy('${set._id}')">Study Set</button>
            `;
            container.appendChild(div);
        });

        }

        loadSavedSets();
        addCard();


        let currentSetCards = [];
        let currentCardIndex = 0;
        let showingFront = true;

        // Load cards from a selected set
        async function loadSetToStudy(setId) {
            const cards = await fetch(`/api/flashcards/cards/by-set/${setId}`).then(res => res.json());
            if (!cards.length) {
                alert("This set has no cards!");
                return;
            }
            currentSetCards = cards;
            currentCardIndex = 0;
            showingFront = true;
            displayCurrentCard();
        }

        function displayCurrentCard() {
            if (!currentSetCards.length) return;

            const card = currentSetCards[currentCardIndex];
            const cardText = showingFront ? card.front : card.back;
            document.getElementById('flashcard').textContent = cardText;
            document.getElementById('card-counter').textContent = `${currentCardIndex + 1} / ${currentSetCards.length}`;
        }

        function nextCard() {
            if (currentSetCards.length === 0) return;
            currentCardIndex = (currentCardIndex + 1) % currentSetCards.length;
            showingFront = true;
            displayCurrentCard();
        }

        function prevCard() {
            if (currentSetCards.length === 0) return;
            currentCardIndex = (currentCardIndex - 1 + currentSetCards.length) % currentSetCards.length;
            showingFront = true;
            displayCurrentCard();
        }

        function shuffleCards() {
            for (let i = currentSetCards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [currentSetCards[i], currentSetCards[j]] = [currentSetCards[j], currentSetCards[i]];
            }
            currentCardIndex = 0;
            showingFront = true;
            displayCurrentCard();
        }

        function flipCard() {
            showingFront = !showingFront;
            displayCurrentCard();
        }

        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                flipCard();
            }
        });

    </script>

</body>
</html>
