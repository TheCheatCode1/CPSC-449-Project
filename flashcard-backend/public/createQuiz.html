<!DOCTYPE html>
<link rel="icon" href="/images/quickflashfav.png" type="image/png">

<html lang="en">
<head>
  <link rel="icon" href="/images/quickflashfav.png" type="image/png">
  <meta charset="UTF-8" />
  <title>Create a Quiz</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      background-color: #B69DDD;
    }

    #sidebar {
      height: 100vh;
      width: 60px;
      background-color: #111;
      overflow-x: hidden;
      transition: width 0.3s;
      color: white;
      display: flex;
      flex-direction: column;
      padding-top: 20px;
      position: relative;
    }

    #sidebar.expanded {
      width: 200px;
    }

    .sidebar-item {
      display: flex;
      align-items: center;
      width: 100%;
      padding: 10px;
      cursor: pointer;
      color: #818181;
      transition: background-color 0.3s, color 0.3s;
    }

    .sidebar-item:hover {
      background-color: #333;
      color: white;
    }

    .sidebar-icon {
      font-size: 20px;
      width: 30px;
      text-align: center;
    }

    .label {
      opacity: 0;
      white-space: nowrap;
      overflow: hidden;
      transition: opacity 0.3s ease, margin-left 0.3s ease;
      margin-left: 0;
    }

    #sidebar.expanded .label {
      opacity: 1;
      margin-left: 10px;
    }

    #sidebar:not(.expanded) .label {
      display: none;
    }

    #logoutButton {
      margin-top: auto;
      margin-bottom: 30px;
    }

    #main-content {
      flex: 1;
      padding: 20px;
    }

    input, textarea, select {
      display: block;
      margin: 10px 0;
      width: 300px;
    }

    .question-block {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 20px;
    }

    .question-block input.option {
      width: 90%;
    }
  </style>
</head>
<body>
<div id="sidebar-container"></div>

<script>
    // Check if user is admin and load appropriate sidebar
    const role = localStorage.getItem('role');
    const sidebarPath = role === 'admin' ? '/adminSidebar.html' : '/sidebar.html';
    
    fetch(sidebarPath)
        .then(response => response.text())
        .then(html => {
            document.getElementById('sidebar-container').innerHTML = html;

            const sidebar = document.getElementById('sidebar');
            if (sidebar) {
                sidebar.addEventListener('mouseenter', () => sidebar.classList.add('expanded'));
                sidebar.addEventListener('mouseleave', () => sidebar.classList.remove('expanded'));
            }

            const logoutButton = document.getElementById('logoutButton');
            if (logoutButton) {
                logoutButton.addEventListener('click', () => {
                    localStorage.clear();
                    window.location.href = '/';
                });
            }
        });
</script>


  <div id="main-content">
    <h2>Create a New Quiz</h2>

    <form id="quizForm">
      <input type="text" id="quizTitle" placeholder="Quiz Title" required />
      <textarea id="quizDesc" placeholder="Quiz Description"></textarea>

      <div id="questionsContainer"></div>

      <button type="button" onclick="addQuestion()">+ Add Question</button>
      <button type="button" onclick="submitQuiz()">Save Quiz</button>

    </form>

    <h3>Saved Quizzes</h3>
<div id="savedQuizzes"></div>

  </div>

  <script>
    const questionsContainer = document.getElementById('questionsContainer');

    function addQuestion() {
      const index = questionsContainer.children.length;
      const div = document.createElement('div');
      div.className = 'question-block';
      div.innerHTML = `
        <input type="text" class="question" placeholder="Question text" required />
        <input type="text" class="option" placeholder="Option A" required />
        <input type="text" class="option" placeholder="Option B" required />
        <input type="text" class="option" placeholder="Option C" />
        <input type="text" class="option" placeholder="Option D" />
        <select class="correct" required>
          <option value="">Select correct answer</option>
          <option value="A">A</option>
          <option value="B">B</option>
          <option value="C">C</option>
          <option value="D">D</option>
        </select>
      `;
      questionsContainer.appendChild(div);
    }

async function submitQuiz() {
  const title = document.getElementById('quizTitle').value;
  const description = document.getElementById('quizDesc').value;
  const blocks = document.querySelectorAll('.question-block');

  const questions = [];

  blocks.forEach(block => {
    const questionText = block.querySelector('.question').value;
    const options = Array.from(block.querySelectorAll('.option')).map(opt => opt.value).filter(Boolean);
    const correct = block.querySelector('.correct').value;
    const correctAnswer = options[['A', 'B', 'C', 'D'].indexOf(correct)];

    questions.push({
      question: questionText,
      options,
      correctAnswer
    });
  });

  const token = localStorage.getItem('token');
  const response = await fetch('/api/quizzes', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({ title, description, questions })
  });

  const result = await response.json();

  if (response.ok && result._id) {
    alert('✅ Quiz saved successfully!');
    loadSavedQuizzes(); // Refresh the Saved Quizzes section
    document.getElementById('quizForm').reset(); // Clear the form
    document.getElementById('questionsContainer').innerHTML = '';
    addQuestion(); // Start fresh
  } else {
    console.error('Quiz creation failed:', result);
    alert('❌ Quiz creation failed. Check console.');
  }
}

document.addEventListener('DOMContentLoaded', () => {
  addQuestion(); // Start with one question once DOM is ready
});

document.addEventListener('DOMContentLoaded', () => {
  loadSavedQuizzes(); // or whatever functions you're running
});


  </script>

  <script>
  async function loadSavedQuizzes() {
    const token = localStorage.getItem('token');
    try {
      const res = await fetch('/api/quizzes', {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });
      const quizzes = await res.json();
      const container = document.getElementById('savedQuizzes');
      container.innerHTML = '';

      if (!quizzes.length) {
        container.textContent = 'No saved quizzes yet.';
        return;
      }

     quizzes.forEach(quiz => {
  const box = document.createElement('div');
  box.style.border = '1px solid #000';
  box.style.padding = '10px';
  box.style.marginBottom = '10px';
  box.style.backgroundColor = '#eee';
  box.style.position = 'relative';

  // Trash can delete button
  const deleteBtn = document.createElement('button');
  deleteBtn.textContent = '🗑️';
  deleteBtn.style.position = 'absolute';
  deleteBtn.style.top = '5px';
  deleteBtn.style.right = '5px';
  deleteBtn.style.border = 'none';
  deleteBtn.style.background = 'transparent';
  deleteBtn.style.cursor = 'pointer';
  deleteBtn.title = 'Delete Quiz';
deleteBtn.onclick = async () => {
  const confirmed = confirm('Are you sure you want to delete this quiz?');
  if (!confirmed) return;

  try {
    const res = await fetch(`/api/quizzes/${quiz._id}`, {
      method: 'DELETE',
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });

    const result = await res.json();
    if (res.ok) {
      alert('✅ Quiz deleted');
      loadSavedQuizzes();
    } else {
      console.error(result);
      alert('❌ Failed to delete quiz');
    }
  } catch (err) {
    console.error(err);
    alert('❌ Failed to delete quiz');
  }
};


  const title = document.createElement('strong');
  title.textContent = quiz.title;

  const desc = document.createElement('p');
  desc.textContent = quiz.description;

  const viewBtn = document.createElement('button');
  viewBtn.textContent = 'View Quiz';
  viewBtn.onclick = () => {
    window.location.href = `/takeQuiz.html?id=${quiz._id}`;
  };

  box.appendChild(deleteBtn);
  box.appendChild(title);
  box.appendChild(desc);
  box.appendChild(viewBtn);
  container.appendChild(box);
});

    } catch (err) {
      console.error('Failed to load saved quizzes:', err);
      document.getElementById('savedQuizzes').textContent = 'Error loading quizzes.';
    }
  }

  // Load on page start
  loadSavedQuizzes();
</script>


    <script>
    const sidebar = document.getElementById('sidebar');
    sidebar.addEventListener('mouseenter', () => {
        sidebar.classList.add('expanded');
    });
    sidebar.addEventListener('mouseleave', () => {
        sidebar.classList.remove('expanded');
    });
  </script>
  </body>
  </html>

</body>
</html>
